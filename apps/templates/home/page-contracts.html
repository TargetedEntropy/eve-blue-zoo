{% extends "layouts/base.html" %}

{% block title %} Page User {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
<div class="row">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h5 class="title">Contract Stalker</h5>
      </div>
      <div class="card-body">
        <form action="/submit" method="GET">
          <input type="text" id="search" name="typeName" placeholder="Search items..." onkeyup="fetchItems()" autocomplete="off">
          <input type="hidden" id="selectedItemID" name="typeID">
          <ul id="results"></ul>
          <br>
          <button type="submit">Submit</button>
      </form>
      </div>
    </div>
  </div>


{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
  async function fetchItems() {
      let query = document.getElementById('search').value;
      if (query.length < 1) return;

      let response = await fetch(`/autocomplete?query=${query}`);
      let data = await response.json();

      let resultsList = document.getElementById('results');
      resultsList.innerHTML = "";

      data.forEach(item => {
          let li = document.createElement("li");
          li.textContent = item.typeName;
          li.onclick = () => selectItem(item);
          resultsList.appendChild(li);
      });
  }

  function selectItem(item) {
      document.getElementById('search').value = item.typeName;
      document.getElementById('selectedItemID').value = item.typeID;
      document.getElementById('results').innerHTML = "";
  }
</script>
{% endblock javascripts %}
